import streamlit as st
import pandas as pd
from data_collector import DataCollector
from analyzer import DataAnalyzer
from datetime import datetime, date
import plotly.express as px
import plotly.graph_objects as go
import traceback

# Configura√ß√£o da p√°gina
st.set_page_config(
    page_title="Controle de Gastos",
    page_icon="üí∞",
    layout="wide"
)

# === IMPORTA√á√ÉO COM TRATAMENTO DE ERRO ===
try:
    from chat_interface import show_chat_interface
    CHAT_AVAILABLE = True
    st.sidebar.success("‚úÖ FinanceBot carregado!")
except Exception as e:
    CHAT_AVAILABLE = False
    st.sidebar.error(f"‚ùå Erro ao carregar FinanceBot: {str(e)}")
    st.sidebar.code(traceback.format_exc())

# Inicializar data collector
@st.cache_resource
def get_data_collector():
    return DataCollector()

data_collector = get_data_collector()

# Sidebar para navega√ß√£o
st.sidebar.title("üí∞ Controle de Gastos")

# === SIDEBAR COM VERIFICA√á√ÉO ===
if CHAT_AVAILABLE:
    opcoes = ["üìä Dashboard", "‚ûï Novo Gasto", "üìã Hist√≥rico", "üìà Relat√≥rios", "ü§ñ FinanceBot"]
else:
    opcoes = ["üìä Dashboard", "‚ûï Novo Gasto", "üìã Hist√≥rico", "üìà Relat√≥rios"]
    st.sidebar.warning("‚ö†Ô∏è FinanceBot indispon√≠vel")

page = st.sidebar.selectbox("Escolha uma p√°gina:", opcoes)

# Cache para dados
@st.cache_data
def load_data():
    """Carrega dados do banco ou fallback"""
    try:
        df = data_collector.load_from_database()
        if not df.empty:
            st.sidebar.success(f"‚úÖ {len(df)} gastos carregados")
            return df
    except Exception as e:
        st.sidebar.warning("‚ö†Ô∏è Usando dados de exemplo")
        return data_collector.collect_sample_data()

def show_dashboard():
    """Dashboard principal REDESENHADO - Interface moderna e intuitiva"""
    
    # üéØ HEADER PRINCIPAL COM DESTAQUE
    st.markdown("""
    <div style="background: linear-gradient(90deg, #1f4068 0%, #2d5a87 100%); 
                padding: 3rem 2rem; margin: -1rem -1rem 2rem -1rem; 
                border-radius: 15px; text-align: center; color: white;">
        <h1 style="margin: 0; font-size: 3rem; font-weight: 700;">üí∞ Dashboard Financeiro</h1>
        <p style="margin: 0.5rem 0 0 0; font-size: 1.2rem; opacity: 0.9;">
            Controle inteligente dos seus gastos com an√°lise em tempo real
        </p>
    </div>
    """, unsafe_allow_html=True)

    # Carregar dados
    df = load_data()
    if df is None or df.empty:
        st.error("‚ùå N√£o foi poss√≠vel carregar os dados!")
        return

    # Filtros na sidebar
    st.sidebar.header("üîç Filtros")
    
    # Filtro por per√≠odo
    periodo = st.sidebar.selectbox(
        "üìÖ Per√≠odo:",
        ["√öltimos 30 dias", "√öltimos 7 dias", "Este m√™s", "√öltimos 3 meses", "Este ano", "Todos"],
        index=0
    )
    
    # Filtro por categoria
    categorias = st.sidebar.multiselect(
        "üè∑Ô∏è Categorias:",
        options=sorted(df['categoria'].unique()),
        default=df['categoria'].unique()
    )
    
    # Aplicar filtros
    df_filtrado = df[df['categoria'].isin(categorias)]
    
    # Filtro por per√≠odo
    if periodo != "Todos":
        hoje = pd.Timestamp.now()
        if periodo == "√öltimos 7 dias":
            data_limite = hoje - pd.Timedelta(days=7)
        elif periodo == "√öltimos 30 dias":
            data_limite = hoje - pd.Timedelta(days=30)
        elif periodo == "Este m√™s":
            data_limite = pd.Timestamp(hoje.year, hoje.month, 1)
        elif periodo == "√öltimos 3 meses":
            data_limite = hoje - pd.Timedelta(days=90)
        elif periodo == "Este ano":
            data_limite = pd.Timestamp(hoje.year, 1, 1)
        
        df_filtrado = df_filtrado[df_filtrado['data'] >= data_limite]

    if df_filtrado.empty:
        st.warning("‚ö†Ô∏è Nenhum gasto encontrado com os filtros selecionados!")
        return

    # An√°lise dos dados
    analyzer = DataAnalyzer(df_filtrado)
    stats = analyzer.get_estatisticas_basicas()

    # üéØ M√âTRICAS PRINCIPAIS - CARDS DESTACADOS
    st.markdown("### üìà Resumo Financeiro")
    
    col1, col2, col3, col4 = st.columns(4)
    
    with col1:
        total_gastos = stats.get('total_gastos', 0)
        st.markdown(f"""
        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                    padding: 1.5rem; border-radius: 15px; text-align: center; color: white; margin-bottom: 1rem;">
            <h3 style="margin: 0; font-size: 1.1rem; opacity: 0.9;">üí∏ Total Gasto</h3>
            <h2 style="margin: 0.5rem 0 0 0; font-size: 2rem; font-weight: bold;">
                R$ {total_gastos:,.2f}
            </h2>
        </div>
        """, unsafe_allow_html=True)
    
    with col2:
        total_transacoes = stats.get('total_transacoes', 0)
        media_gastos = stats.get('media_gastos', 0)
        st.markdown(f"""
        <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); 
                    padding: 1.5rem; border-radius: 15px; text-align: center; color: white; margin-bottom: 1rem;">
            <h3 style="margin: 0; font-size: 1.1rem; opacity: 0.9;">üìä Transa√ß√µes</h3>
            <h2 style="margin: 0.5rem 0 0 0; font-size: 2rem; font-weight: bold;">
                {total_transacoes}
            </h2>
            <p style="margin: 0.2rem 0 0 0; font-size: 0.9rem; opacity: 0.8;">
                M√©dia: R$ {media_gastos:.2f}
            </p>
        </div>
        """, unsafe_allow_html=True)
    
    with col3:
        categoria_top = stats.get('categoria_mais_gasta', 'N/A')
        st.markdown(f"""
        <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); 
                    padding: 1.5rem; border-radius: 15px; text-align: center; color: white; margin-bottom: 1rem;">
            <h3 style="margin: 0; font-size: 1.1rem; opacity: 0.9;">üèÜ Categoria Top</h3>
            <h2 style="margin: 0.5rem 0 0 0; font-size: 1.5rem; font-weight: bold;">
                {categoria_top}
            </h2>
        </div>
        """, unsafe_allow_html=True)
    
    with col4:
        maior_gasto = stats.get('maior_gasto', 0)
        menor_gasto = stats.get('menor_gasto', 0)
        st.markdown(f"""
        <div style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); 
                    padding: 1.5rem; border-radius: 15px; text-align: center; color: white; margin-bottom: 1rem;">
            <h3 style="margin: 0; font-size: 1.1rem; opacity: 0.9;">üí∞ Maior Gasto</h3>
            <h2 style="margin: 0.5rem 0 0 0; font-size: 1.6rem; font-weight: bold;">
                R$ {maior_gasto:.2f}
            </h2>
            <p style="margin: 0.2rem 0 0 0; font-size: 0.9rem; opacity: 0.8;">
                Menor: R$ {menor_gasto:.2f}
            </p>
        </div>
        """, unsafe_allow_html=True)

    st.markdown("---")

    # üéØ GR√ÅFICOS PRINCIPAIS - LAYOUT OTIMIZADO
    col1, col2 = st.columns([2, 1])
    
    with col1:
        st.markdown("### üìà Evolu√ß√£o dos Gastos no Tempo")
        try:
            gastos_diarios = df_filtrado.groupby('data')['valor'].sum().reset_index()
            
            fig_linha = px.line(
                gastos_diarios,
                x='data',
                y='valor',
                title='',
                labels={'valor': 'Valor (R$)', 'data': 'Data'},
                color_discrete_sequence=['#667eea']
            )
            
            fig_linha.update_layout(
                height=400,
                plot_bgcolor='rgba(0,0,0,0)',
                paper_bgcolor='rgba(0,0,0,0)',
                font=dict(color='#333'),
                xaxis=dict(showgrid=True, gridwidth=1, gridcolor='rgba(0,0,0,0.1)'),
                yaxis=dict(showgrid=True, gridwidth=1, gridcolor='rgba(0,0,0,0.1)')
            )
            
            fig_linha.update_traces(
                line=dict(width=3),
                hovertemplate='<b>%{x}</b><br>R$ %{y:,.2f}<extra></extra>'
            )
            
            st.plotly_chart(fig_linha, use_container_width=True)
        except Exception as e:
            st.error(f"Erro ao criar gr√°fico de linha: {e}")
    
    with col2:
        st.markdown("### ü•ß Distribui√ß√£o por Categoria")
        try:
            categoria_gastos = analyzer.gastos_por_categoria()
            
            colors = ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe', '#00f2fe', '#fa709a', '#fee140']
            
            fig_pizza = px.pie(
                values=categoria_gastos.values,
                names=categoria_gastos.index,
                title='',
                color_discrete_sequence=colors
            )
            
            fig_pizza.update_layout(
                height=400,
                plot_bgcolor='rgba(0,0,0,0)',
                paper_bgcolor='rgba(0,0,0,0)',
                font=dict(color='#333'),
                showlegend=True,
                legend=dict(
                    orientation="v",
                    yanchor="middle",
                    y=0.5,
                    xanchor="left",
                    x=1.05
                )
            )
            
            fig_pizza.update_traces(
                textposition='inside',
                textinfo='percent',
                hovertemplate='<b>%{label}</b><br>R$ %{value:,.2f}<br>%{percent}<extra></extra>'
            )
            
            st.plotly_chart(fig_pizza, use_container_width=True)
        except Exception as e:
            st.error(f"Erro ao criar gr√°fico de pizza: {e}")

    # üéØ SE√á√ÉO DE INSIGHTS
    st.markdown("### üéØ Insights e Recomenda√ß√µes")
    
    col1, col2 = st.columns(2)
    
    with col1:
        st.markdown("#### üí∏ Maiores Gastos do Per√≠odo")
        top_gastos = analyzer.get_top_gastos(5)
        if not top_gastos.empty:
            for idx, gasto in top_gastos.iterrows():
                data_formatada = gasto['data'].strftime('%d/%m/%Y')
                st.markdown(f"""
                <div style="background: #f8f9fa; padding: 1rem; margin: 0.5rem 0; 
                           border-radius: 10px; border-left: 4px solid #667eea;">
                    <strong>R$ {gasto['valor']:,.2f}</strong> - {gasto['categoria']}<br>
                    <small style="color: #666;">{gasto['descricao']} ‚Ä¢ {data_formatada}</small>
                </div>
                """, unsafe_allow_html=True)
    
    with col2:
        st.markdown("#### üìä Resumo por Categoria")
        categoria_resumo = df_filtrado.groupby('categoria').agg({
            'valor': ['sum', 'count', 'mean']
        }).round(2)
        categoria_resumo.columns = ['Total (R$)', 'Qtd', 'M√©dia (R$)']
        categoria_resumo = categoria_resumo.sort_values('Total (R$)', ascending=False)
        
        # Exibir como cards
        for categoria, row in categoria_resumo.head().iterrows():
            percentual = (row['Total (R$)'] / total_gastos) * 100
            st.markdown(f"""
            <div style="background: #f8f9fa; padding: 1rem; margin: 0.5rem 0; 
                       border-radius: 10px; border-left: 4px solid #f5576c;">
                <strong>{categoria}</strong><br>
                <span style="color: #667eea; font-weight: bold;">R$ {row['Total (R$)']:,.2f}</span> 
                ({percentual:.1f}%)<br>
                <small style="color: #666;">{int(row['Qtd'])} gastos ‚Ä¢ M√©dia R$ {row['M√©dia (R$)']:.2f}</small>
            </div>
            """, unsafe_allow_html=True)

    # üéØ CALL TO ACTION
    st.markdown("---")
    col1, col2, col3 = st.columns(3)
    
    with col1:
        if st.button("‚ûï Adicionar Novo Gasto", use_container_width=True, type="primary"):
            st.switch_page("pages/novo_gasto.py")  # Navegar para p√°gina de novo gasto
    
    with col2:
        if st.button("ü§ñ Chat com FinanceBot", use_container_width=True):
            st.switch_page("pages/financebot.py")  # Navegar para chat
    
    with col3:
        if st.button("üìà Ver Relat√≥rios Completos", use_container_width=True):
            st.switch_page("pages/relatorios.py")  # Navegar para relat√≥rios

    # üéØ ALERTAS E DICAS PERSONALIZADAS
    st.markdown("### üí° Dicas Personalizadas")
    
    # An√°lise inteligente dos gastos
    if total_gastos > 0:
        categoria_dominante = stats.get('categoria_mais_gasta', '')
        if categoria_dominante:
            categoria_valor = df_filtrado[df_filtrado['categoria'] == categoria_dominante]['valor'].sum()
            categoria_pct = (categoria_valor / total_gastos) * 100
            
            if categoria_pct > 40:
                st.info(f"üí° **Dica:** {categoria_pct:.0f}% dos seus gastos s√£o em {categoria_dominante}. "
                        f"Considere revisar esses gastos para encontrar oportunidades de economia!")
            
            if maior_gasto > media_gastos * 3:
                st.warning(f"‚ö†Ô∏è **Aten√ß√£o:** Voc√™ teve um gasto de R$ {maior_gasto:.2f}, bem acima da sua m√©dia. "
                          f"Monitore gastos altos para manter o controle!")
            
            # Dica baseada no per√≠odo
            if periodo == "√öltimos 30 dias" and total_gastos > 3000:
                economia_sugerida = total_gastos * 0.1
                st.success(f"üéØ **Meta:** Tente economizar R$ {economia_sugerida:.2f} no pr√≥ximo m√™s "
                          f"(10% dos gastos atuais) para melhorar sua sa√∫de financeira!")

def show_cadastro():
    """P√°gina de cadastro de novos gastos"""
    st.title("‚ûï Cadastro de Novo Gasto")
    st.markdown("Registre seus gastos para manter o controle financeiro:")

    # Formul√°rio de cadastro
    with st.form("form_cadastro_gasto", clear_on_submit=True):
        col1, col2 = st.columns(2)
        
        with col1:
            # Data do gasto
            data_gasto = st.date_input(
                "üìÖ Data do Gasto:",
                value=date.today(),
                max_value=date.today(),
                help="Data em que o gasto foi realizado"
            )
            
            # Categoria
            categoria = st.selectbox(
                "üè∑Ô∏è Categoria:",
                options=["Alimenta√ß√£o", "Transporte", "Lazer", "Sa√∫de", "Roupas", "Mensalidades", "Outros"],
                help="Selecione a categoria do gasto"
            )
            
            # Descri√ß√£o
            descricao = st.text_input(
                "üìù Descri√ß√£o:",
                max_chars=200,
                help="Descreva brevemente o gasto"
            )
        
        with col2:
            # Valor do gasto
            valor_gasto = st.number_input(
                "üí∞ Valor (R$):",
                min_value=0.01,
                max_value=999999.99,
                value=10.00,
                step=0.01,
                help="Valor gasto em reais"
            )
            
            # Forma de pagamento
            forma_pagamento = st.selectbox(
                "üí≥ Forma de Pagamento:",
                options=["Dinheiro", "Cart√£o Cr√©dito", "Cart√£o D√©bito", "PIX", "D√©bito Autom√°tico", "Outros"],
                help="Como foi realizado o pagamento"
            )
            
            # Observa√ß√µes adicionais
            observacoes = st.text_area(
                "üìã Observa√ß√µes (opcional):",
                max_chars=300,
                help="Informa√ß√µes adicionais sobre o gasto"
            )
        
        # Bot√£o de submiss√£o
        submitted = st.form_submit_button(
            "üíæ Registrar Gasto",
            use_container_width=True,
            type="primary"
        )
        
        if submitted:
            # Valida√ß√µes
            if not categoria or not descricao:
                st.error("‚ùå Categoria e descri√ß√£o s√£o obrigat√≥rios!")
                return
            
            if valor_gasto <= 0:
                st.error("‚ùå O valor deve ser maior que zero!")
                return
            
            # Preparar dados para salvar
            novo_gasto = {
                'data': data_gasto,
                'valor': float(valor_gasto),
                'categoria': categoria,
                'descricao': descricao,
                'forma_pagamento': forma_pagamento
            }
            
            # Tentar salvar no banco
            try:
                df_novo = pd.DataFrame([novo_gasto])
                success = data_collector.insert_new_expense(df_novo)
                
                if success:
                    st.success("‚úÖ Gasto registrado com sucesso!")
                    st.balloons()
                    
                    # Mostrar resumo
                    st.info(f"""
                    **üìã Gasto Registrado:**
                    - **Data:** {data_gasto.strftime('%d/%m/%Y')}
                    - **Categoria:** {categoria}
                    - **Valor:** R$ {valor_gasto:,.2f}
                    - **Descri√ß√£o:** {descricao}
                    - **Forma de Pagamento:** {forma_pagamento}
                    {f"- **Observa√ß√µes:** {observacoes}" if observacoes else ""}
                    """)
                    
                    # Limpar cache
                    st.cache_data.clear()
                else:
                    st.error("‚ùå Erro ao registrar o gasto. Tente novamente.")
            except Exception as e:
                st.error(f"‚ùå Erro ao processar registro: {str(e)}")

def show_historico():
    """P√°gina de hist√≥rico completo"""
    st.title("üìã Hist√≥rico de Gastos")
    
    df = load_data()
    if df is None or df.empty:
        st.error("‚ùå Nenhum gasto encontrado!")
        return

    # Estat√≠sticas gerais
    col1, col2, col3, col4 = st.columns(4)
    
    with col1:
        st.metric("üìä Total de Registros", len(df))
    
    with col2:
        st.metric("üí∞ Total Gasto", f"R$ {df['valor'].sum():,.2f}")
    
    with col3:
        st.metric("üìÖ Primeiro Registro", df['data'].min().strftime('%d/%m/%Y'))
    
    with col4:
        st.metric("üìÖ √öltimo Registro", df['data'].max().strftime('%d/%m/%Y'))

    st.markdown("---")

    # Filtros
    col1, col2, col3 = st.columns(3)
    
    with col1:
        categorias_hist = st.multiselect(
            "Filtrar por Categoria:",
            options=sorted(df['categoria'].unique()),
            default=df['categoria'].unique()
        )
    
    with col2:
        if 'forma_pagamento' in df.columns:
            pagamentos_hist = st.multiselect(
                "Forma de Pagamento:",
                options=sorted(df['forma_pagamento'].unique()),
                default=df['forma_pagamento'].unique()
            )
        else:
            pagamentos_hist = []
    
    with col3:
        periodo_hist = st.selectbox(
            "Per√≠odo:",
            ["Todos", "√öltimos 30 dias", "√öltimos 90 dias", "Este ano"]
        )

    # Aplicar filtros
    df_filtrado = df[df['categoria'].isin(categorias_hist)]
    
    if pagamentos_hist and 'forma_pagamento' in df.columns:
        df_filtrado = df_filtrado[df_filtrado['forma_pagamento'].isin(pagamentos_hist)]

    # Filtro por per√≠odo
    if periodo_hist != "Todos":
        hoje = pd.Timestamp.now()
        if periodo_hist == "√öltimos 30 dias":
            data_limite = hoje - pd.Timedelta(days=30)
        elif periodo_hist == "√öltimos 90 dias":
            data_limite = hoje - pd.Timedelta(days=90)
        elif periodo_hist == "Este ano":
            data_limite = pd.Timestamp(hoje.year, 1, 1)
        
        df_filtrado = df_filtrado[df_filtrado['data'] >= data_limite]

    # Ordenar por data
    df_filtrado = df_filtrado.sort_values('data', ascending=False)

    st.subheader(f"üìä Exibindo {len(df_filtrado)} registros")

    # Pagina√ß√£o
    registros_por_pagina = st.selectbox("Registros por p√°gina:", [10, 25, 50])
    
    if len(df_filtrado) > registros_por_pagina:
        total_paginas = (len(df_filtrado) // registros_por_pagina) + 1
        pagina = st.number_input("P√°gina:", 1, total_paginas, 1)
        inicio = (pagina - 1) * registros_por_pagina
        fim = inicio + registros_por_pagina
        df_exibir = df_filtrado.iloc[inicio:fim]
        st.write(f"P√°gina {pagina} de {total_paginas}")
    else:
        df_exibir = df_filtrado

    # Formatar para exibi√ß√£o
    df_display = df_exibir.copy()
    df_display['data'] = df_display['data'].dt.strftime('%d/%m/%Y')
    df_display['valor'] = df_display['valor'].apply(lambda x: f"R$ {x:,.2f}")

    st.dataframe(df_display, use_container_width=True, hide_index=True)

    # Download
    if not df_filtrado.empty:
        csv = df_filtrado.to_csv(index=False)
        st.download_button(
            label="üì• Download dos Dados (CSV)",
            data=csv,
            file_name=f'gastos_{datetime.now().strftime("%Y%m%d_%H%M")}.csv',
            mime='text/csv'
        )

def show_relatorios():
    """P√°gina de relat√≥rios avan√ßados"""
    st.title("üìà Relat√≥rios Avan√ßados")
    
    df = load_data()
    if df is None or df.empty:
        st.error("‚ùå Nenhum dado para gerar relat√≥rios!")
        return

    analyzer = DataAnalyzer(df)

    # Relat√≥rio mensal
    st.subheader("üìÖ Gastos Mensais por Categoria")
    try:
        fig_mensal = analyzer.criar_grafico_mensal()
        st.plotly_chart(fig_mensal, use_container_width=True)
    except Exception as e:
        st.error(f"Erro ao gerar gr√°fico mensal: {e}")

    st.markdown("---")

    # Comparativo por forma de pagamento
    if 'forma_pagamento' in df.columns:
        st.subheader("üí≥ Gastos por Forma de Pagamento")
        pagamento_gastos = analyzer.gastos_por_forma_pagamento()
        
        col1, col2 = st.columns(2)
        
        with col1:
            fig_pagamento = px.pie(
                values=pagamento_gastos.values,
                names=pagamento_gastos.index,
                title="Distribui√ß√£o por Forma de Pagamento"
            )
            st.plotly_chart(fig_pagamento, use_container_width=True)
        
        with col2:
            st.write("**Resumo por Forma de Pagamento:**")
            pagamento_resumo = pd.DataFrame({
                'Total (R$)': pagamento_gastos.values,
                'Percentual (%)': (pagamento_gastos.values / pagamento_gastos.sum() * 100).round(1)
            }, index=pagamento_gastos.index)
            st.dataframe(pagamento_resumo.sort_values('Total (R$)', ascending=False))

    st.markdown("---")

    # Resumo estat√≠stico
    st.subheader("üìä Resumo Estat√≠stico")
    stats = analyzer.get_estatisticas_basicas()
    
    col1, col2, col3 = st.columns(3)
    
    with col1:
        st.metric("üí∏ Gasto Total", f"R$ {stats.get('total_gastos', 0):,.2f}")
        st.metric("üìä Total de Transa√ß√µes", stats.get('total_transacoes', 0))
    
    with col2:
        st.metric("üìà Gasto M√©dio", f"R$ {stats.get('media_gastos', 0):.2f}")
        st.metric("üéØ Gasto Mediano", f"R$ {stats.get('mediana_gastos', 0):.2f}")
    
    with col3:
        st.metric("üîù Maior Gasto", f"R$ {stats.get('maior_gasto', 0):,.2f}")
        st.metric("üîª Menor Gasto", f"R$ {stats.get('menor_gasto', 0):.2f}")

# === ROTEAMENTO COMPLETO COM FINANCEBOT ===
if page == "üìä Dashboard":
    show_dashboard()
elif page == "‚ûï Novo Gasto":
    show_cadastro()
elif page == "üìã Hist√≥rico":
    show_historico()
elif page == "üìà Relat√≥rios":
    show_relatorios()
elif page == "ü§ñ FinanceBot":
    st.sidebar.info("ü§ñ Carregando FinanceBot...")
    if CHAT_AVAILABLE:
        try:
            show_chat_interface()
        except Exception as e:
            st.error(f"‚ùå Erro ao executar FinanceBot: {str(e)}")
            st.code(traceback.format_exc())
            st.info("üí° Verifique se configurou GROQ_API_KEY no arquivo .env")
    else:
        st.error("‚ùå FinanceBot n√£o est√° dispon√≠vel")
        st.info("üí° Verifique os logs de erro na sidebar")

# Footer
st.markdown("---")
st.markdown("""
<div style="text-align: center; padding: 2rem; background: #f8f9fa; 
           border-radius: 10px; margin-top: 2rem;">
    <p style="margin: 0; color: #666; font-size: 0.9rem;">
        üí∞ <strong>Controle de Gastos</strong> | 
        Desenvolvido com ‚ù§Ô∏è usando Python + Streamlit + IA<br>
        <strong>Maur√≠cio Brescianini Marques</strong> | Projeto Portfolio 2024
    </p>
</div>
""", unsafe_allow_html=True)